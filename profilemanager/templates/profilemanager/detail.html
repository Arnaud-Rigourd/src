{% extends 'base.html' %}

{% block title %}
    {% if current_user == user %}
        <title>{{ user.first_name }} | Ton profil </title>
    {% else %}
        <title>{{ user.first_name }} | Dev {{ profile.job }}</title>
    {% endif %}
{% endblock %}

{% block content %}

<h1>Hello on {{ user.first_name }} {{ user.last_name }} profile !</h1>
<header class="profile__info-user">
    <p><img src="{{ user.profile_image }}" alt="Photo de {{ user.first_name }} {{ user.last_name }}" /></p>
    {% if current_user.slug == slug %}
        <p><a href="{% url 'accounts:update_profile_picture' pk=current_user.pk %}">Modifier photo de profil</a></p>
    {% endif %}
    <h3>DÃ©veloppeur {{ user.profile.job }}</h3>
    <p>email : {{ user.email }}</p>
    {% if user.phone_number %}
        <p>Tel : {{ user.phone_number }}</p>
    {% endif %}
</header>

{% if profile %}
    <section class="profile__info">
        <h2>{{ user.first_name }}, sa vie et ses passions</h2>
        {% if current_user.slug == slug %}
            <p><a href="{% url 'profilemanager:update' slug=slug %}">Modifier</a></p>
        {% endif %}
        <p class="user-description">
            {{ profile.description }}
        </p>
    </section>

    <section class="profile__stacks">
        <h2>Ses stacks</h2>
        {% if current_user.slug == slug %}
            <form hx-post="{% url 'profilemanager:stack-create' %}" hx-target="#stacks-target" hx-swap="beforeend">
                {% csrf_token %}
                {{ stack_form.as_p }}
                <button type="submit">Ajouter une stack</button>
            </form>
        {% endif %}
        <ul id="stacks-target">
            {% for stack in stacks %}
                <li id="stack{{ stack.pk }}" class="stack">
                    {{ stack }}
                    {% if current_user.slug == slug %}
                    <form hx-post="{% url 'profilemanager:stack-update' pk=stack.pk slug=slug %}" hx-target="#stack{{ stack.pk }}">
                        {% csrf_token %}
                        <input type="text" name="name" value="{{ stack.name }}">
                        <input type="hidden" name="stack_id" value="{{ stack.pk }}">
                        <button type="submit">Modifier</button>
                    </form>
                    <form hx-post="{% url 'profilemanager:stack-delete' pk=stack.pk slug=slug %}" hx-target="#stack{{ stack.pk }}">
                        {% csrf_token %}
                        <input type="hidden" name="stack_id" value="{{ stack.pk }}">
                        <button type="submit">Supprimer</button>
                    </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </section>
    {% endif %}
    
    <section class="profile__projects">
        <h2>Ses projets</h2>
        {% if current_user.slug == slug %}
            <form method="POST" action="{% url 'profilemanager:project-create' %}">
                {% csrf_token %}
                {{ project_form.as_p }}
                <button type="submit">Ajouter un projet</button>
            </form>
        {% endif %}

        {% for project in projects %}
            <div class="project">
                <h3>
                    {{ project.name }}
                    {% if current_user.slug == slug %}
                    <p><a href="{% url 'profilemanager:project-update' pk=project.pk slug=slug %}">Modifier</a></p>
                    <form method="POST" action="{% url 'profilemanager:project-delete' pk=project.pk slug=slug  %}">
                        {% csrf_token %}
                        <input type="hidden" name="project_id" value="{{ project.pk }}">
                        <button type="submit">Supprimer</button>
                    </form>
                    {% endif %}
                </h3>
                <p>Description du projet : {{ project.description }}</p>
                <p class="{% if not project.link %}hidden{% endif %}">Lien : <a href="{{ project.link }}" target="_blank">{{ project.link }}</a></p>
                <p>Stacks : {{ project.used_stacks }}</p>
            </div>
        {% endfor %}
    </section>
{% endblock %}